<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"></script>

    <title>ACME | Inventario (Nuevo)</title>

    <style>
      body {
        background: #ffE1E1;
        background: linear-gradient(to right, #58a3d1,#ffE1E1);
      }
      thead{
        background-color: #2f2f2f;
        color: white;
      }
      td{
        text-align: left;
      }
      td:first-child {
        font-weight: bold;
        text-align: left;
      }
    </style>



  </head>
  <body>
    <h1 class= "fw-bold text-center py-2">Inventario</h1>
    <div class="container bg-white mt-5 rounded shadow" style="padding-top: 20px; margin-bottom: 50px;">
      <div class="table-responsive">
        <h3 class="fw-bold text-center">Inventario</h3>
        <div class="justify-content-center" style="float: right; margin-bottom: 20px; margin-right: 20px;">
          <button type="button" class="btn btn-primary btn-block btn-default" data-bs-toggle="modal" data-bs-target="#agregarProdModal">Registrar producto</button>
        </div>
        <div class="card-body">
          <div class="table-responsive-sm table-primary">
            <table class="table table-striped border-dark" id="myTable">
              <thead> 
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Precio</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr class="align-middle">
                  <td>1</td>
                  <td>Canivex</td>
                  <td>15000</td>
                  <td class="justify-content-center">
                    <button type="button" class="btn btn-warning">Modificar</button>
                    <button type="button" class="btn btn-danger">Eliminar</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>


    <!-- MODALES -->
    <div class="modal fade" id="agregarProdModal">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

          <!-- Modal Header -->
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel"><strong>Agregar producto</strong></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <!-- Modal body -->
          <div class="modal-body" id="divConfFact">
            <div class="col form-group">
              <label>Nombre</label>
              <input type="text" id="nombreAg" class="form-control" placeholder="Ingrese el nombre del producto" autocomplete="off">
            </div>
            <div class="col form-group mgt">
              <label>Precio</label>   
              <input type="text" id="precioAg" class="form-control" placeholder="Ingrese el precio del producto" autocomplete="off">
            </div>
          </div>

          <!-- Modal footer -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Volver</button>
            <button type="button" class="btn btn-primary" onclick="agregarProducto()" data-bs-dismiss="modal">Agregar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL PARA MODIFICAR VALORES -->
    <div class="modal fade" id="modProdModal">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

          <!-- Modal Header -->
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel"><strong>Modificar producto</strong></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <!-- Modal body -->
          <div class="modal-body" id="divConfFact">
            <div class="col form-group">
              <label>Nombre</label>
              <input type="text" id="nombreMod" class="form-control" placeholder="Ingrese el nuevo nombre del producto" autocomplete="off">
            </div>
            <div class="col form-group mgt">
              <label>Precio</label>   
              <input type="text" id="precioMod" class="form-control" placeholder="Ingrese el nuevo precio del producto" autocomplete="off">
            </div>
          </div>

          <!-- Modal footer -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Volver</button>
            <button type="button" class="btn btn-primary" onclick="modInfo()" data-bs-dismiss="modal">Agregar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- TERMINA MODALES -->


    <script>
      var table = document.getElementById("myTable");

      // AGREGAR VALORES A LA TABLA
      function agregarProducto(){
        let tbodyRowCount = table.tBodies[0].rows.length;
        let ID = parseInt(table.rows[tbodyRowCount].cells[0].innerHTML) + 1;
        let row = table.insertRow();
        row.classList.add("align-middle");
        let cell1 = row.insertCell(0);
        let cell2 = row.insertCell(1);
        let cell3 = row.insertCell(2);
        let cell4 = row.insertCell(3);
        cell1.innerHTML = ID;
        cell2.innerHTML = document.getElementById("nombreAg").value;
        cell3.innerHTML = "$" + formato(document.getElementById("precioAg").value);
        cell4.classList.add("justify-content-center");
        document.getElementById("nombreAg").value = "";
        document.getElementById("precioAg").value = "";
        creacionBotonesModEli();
      }

      // CREACION BOTONES NUEVOS
      function creacionBotonesModEli(){
        let tbodyRowCount = table.tBodies[0].rows.length;
        let celda = table.rows[tbodyRowCount].cells[3];
        let btnMod = document.createElement("button");
        let btnEli = document.createElement("button");
        btnMod.innerHTML = "Modificar";
        btnMod.className = "btn btn-warning";
        btnMod.style.marginRight = "5px";
        btnEli.innerHTML = "Eliminar";
        btnEli.className = "btn btn-danger";
        celda.appendChild(btnMod);
        celda.appendChild(btnEli);
        btnMod.onclick = modalModInfo;
        btnMod.setAttribute("data-bs-toggle", "modal");
        btnMod.setAttribute("data-bs-target", "#modProdModal");
        btnEli.onclick = alerta;
      }

      // MODIFICAR INFORMACIÓN
      function modalModInfo(){
        let rowID = event.target.parentNode.parentNode;
        btnPress = rowID;
        let nombreProd = rowID.cells[1].innerHTML;
        let precioProd = limpiarPrecio(rowID.cells[2].innerHTML);
        document.getElementById("nombreMod").value = nombreProd;
        document.getElementById("precioMod").value = precioProd;
      }

      function modInfo(){
        btnPress.cells[1].innerHTML = document.getElementById("nombreMod").value;
        btnPress.cells[2].innerHTML = document.getElementById("precioMod").value;
        document.getElementById("nombreMod").value = "";
        document.getElementById("precioMod").value = "";
      }

      // ELIMINAR INFORMACION
      function alerta(){
        let rowID = event.target.parentNode.parentNode;
        let nomProdDel = rowID.cells[1].innerHTML;
        let opcion = confirm("¿Está seguro que desea borra el producto " + nomProdDel);
        if (opcion == true) {
          rowID.remove();
        }
      }

      // DAR FORMATO A NUMEROS
      function formato(numero){
        if(numero < 1000){
          return String(numero);
        }
        else if(numero < 1000000){
          return formatoMil(numero);
        }else if(numero >= 1000000){
          return formatoMillon(numero);
        }
      }

      // DAR FORMATO DE MIL
      function formatoMil(numero){
        string = numero.toString();
        let posPunto = string.length % 3;
        if(posPunto == 0){
          string = string.substring(0, posPunto+3) + "." + string.substring(posPunto+3, string.length);
        }else{
          string = string.substring(0, posPunto) + "." + string.substring(posPunto, string.length);
        }
        return string;
      }

      // CONVIERTE EL STRING DE UN PRECIO A UN NUMERO ENTERO
      function limpiarPrecio(string){
        let valor = string;
        valor = valor.slice(1);
        valor = valor.replace(",", "");
        valor = valor.replace(".", "");
        valor = parseInt(valor);
        return valor
      }

    </script>

  </body>
</html>