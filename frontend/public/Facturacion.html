<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"></script>

    <title>ACME | Facturación</title>

    <style>
      body{
        background: #ffE1E1;
        background: linear-gradient(to right, #58a3d1,#ffE1E1);
      }
      thead{
        background-color: #2f2f2f;
        color: white;
      }
      td:first-child {
        font-weight: bold;
        text-align: left;
        padding-left: 25px;
      }
      .padd{
        padding-top: -5px;
      }

    </style>

</head>

<body>

  <div class="container" style="margin-top: 50px; padding-bottom: 50px;">
    <div class="card">
      <div class="card-header">
        <strong>Generar factura</strong>
      </div>
      <div class="card-body">

        <!-- VERIFICAR CÉDULA DE LA PERSONA A QUIEN GENERAN LA FACTURA -->
        <div class="row mb-4">
          <div class="col-sm-4">

          </div>
          <div class="col-sm-4">
            <label>Ingrese la cédula de la persona a generar la factura</label>
            <input type="text" name="numonly" maxlength="10" min="0" class="form-control" placeholder="" style="margin-top: 5px;" autocomplete="off">
            <div class="col text-center">
              <button type="button" class="btn btn-info" onclick="agregarDatos()" style="margin-top: 5px; width: 200px; font-weight: bold;">Verificar</button>
            </div>
          </div>
        </div>

        <!-- COLUMNA CON LOS DATOS DEL CLIENTE -->
        <div class="row mb-4">
          <div class="col-sm-3">
            <h6 class="mb-3">Cobrar a:</h6>
            <div style="margin-top: -5px;"><p id="nombreCliente"></p></div>
            <div style="margin-top: -15px;"><p id="cedulaCliente"></p></div>
          </div>
          <div class="col-sm-3">
            <h6 class="mb-3">Enviar a:</h6>
            <div style="margin-top: -5px;"><p id="direccionCliente"></p></div>
            <div style="margin-top: -15px;"><p id="ciudadCliente"></p></div>
          </div>
          <div class="col-sm-2">

          </div>

          <!-- COLUMNA FECHA, MÉTODO Y VENCIMIENTO -->
          <div class="col-sm-4">
            <div class="row mb-4">
              <div class="col-sm-6">
                <p style="text-align: right;">Fecha:</p>
              </div>
              <div class="col-sm-6">
                <p id="tDate" style="text-align: right;"></p>
              </div>
            </div>
            <div class="row mb-4" style="margin-top: -25px;">
              <div class="col-sm-6" style="padding-top: 5px;">
                <p style="text-align: right;">Condiciones de pago:</p>
              </div>
              <div class="col-sm-6">
                <select id="selMet" class="form-control" style="text-align: right;" autocomplete="off">
                  <option selected="" disabled="" value="">Escoger método</option>
                  <option>Efectivo</option>
                  <option>Tarjeta</option>
                </select>
              </div>
            </div>
            <div class="row mb-4" style="margin-top: -15px;">
              <div class="col-sm-6">
                <p style="text-align: right;">Fecha de vencimiento:</p>
              </div>
              <div class="col-sm-6">
                <p id="eDate" style="text-align: right;"></p>
              </div>
            </div>
          </div>
        </div>

        <!-- FILA DONDE SE AGREGAN LOS PRODDUCTOS A LA FACTURA -->
        <div class="row mb-4 justify-content-center" style="margin-top: -30px;">
          <div class="col-sm-4">
            <label style="text-align: center;">Seleccione el producto a añadir</label>
            <select id="selPro" class="form-control" style="text-align: center; margin-top: 5px;" autocomplete="off">
              <option selected="" disabled="" value="">Escoger producto</option>
            </select>
          </div>
          <div class="col-sm-4">
            <label>Ingrese la cantidad del producto</label>
            <input type="number" id="cantidadProducto" name="quantity" min="1" maxlength="3" class="form-control" placeholder="Ingrese la cantidad del producto" style="margin-top: 5px;" autocomplete="off">
          </div>
          <div class="row mb-4" style="margin-top: 5px;">
            <div class="col text-center">
              <button type="button" class="btn btn-info" onclick="agregarProducto()" style="margin-top: 5px; width: 250px; font-weight: bold;">Agregar producto a la factura</button>
            </div>
          </div>
        </div>

        <!-- TABLA DE PRODUCTOS -->
        <div class="table-responsive-sm table-primary">
          <table class="table table-striped" id="myTable">
            <thead>
              <tr>
                <th style="width: 650px; padding-left:25px;">Artículo</th>
                <th>Costo unidad</th>
                <th>Cantidad</th>
                <th>Total</th>
              </tr>
            </thead>

            <tbody id="bodyFact">
              
            </tbody>
          </table>
      </div>
          <div class="row">
            <div class="col-lg-4 col-sm-5">

            </div>
            <div class="col-lg-4 col-sm-8">

            </div>
            <div class="col-lg-4 col-sm-8 ml-auto">
              <table class="table table-clear">
                <tbody>
                  <tr>
                    <td>
                      Total
                    </td>
                    <td id="valTot">
                      <!-- SUMA DE LOS VALORES TOTALES DE LOS PRODUCTOS EN LA FACTURA -->
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="justify-content-right" style="margin-top: 20px; float: right;">
            <button type="submit" class="btn btn-secondary btn-block btn-default">Volver</button>
            <button type="submit" class="btn btn-warning btn-block btn-default" onclick="limpiarTabla()">Limpiar factura</button>
            <button type="button" class="btn btn-primary btn-block btn-default" data-bs-toggle="modal" data-bs-target="#exampleModalCenter" onclick="mostrarValorFacturaModal()">Generar factura</button>
          </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModalCenter">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

          <!-- Modal Header -->
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Generando factura...</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <!-- Modal body -->
          <div class="modal-body" id="divConfFact">
            
          </div>

          <!-- Modal footer -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Volver</button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
          </div>
        </div>
      </div>
    </div>

  </div>



  <script>

    var table = document.getElementById("myTable");

    // DATOS PARA OBTENER LA FECHA DEL DÍA ACTUAL
    n =  new Date();
    y = n.getFullYear();
    m = n.getMonth() + 1;
    d = n.getDate();
    document.getElementById("tDate").innerHTML = d + "/" + m + "/" + y; 
    document.getElementById("tDate").style.fontWeight = "bold";
    document.getElementById("eDate").innerHTML = d + "/" + m + "/" + y; 
    document.getElementById("eDate").style.fontWeight = "bold";

    // Placeholders para la información del cliente
    var nombreCli = "Sebastian Andica";
    var cedulaCli = "4145815165";
    var direccionCli = "Detrás de La 14 (¿Eso sigue existiendo?)";
    var ciudadCli = "En el centro del Valle";

    document.getElementById("nombreCliente").innerHTML = nombreCli;
    document.getElementById("nombreCliente").style.fontWeight = "bold";
    document.getElementById("cedulaCliente").innerHTML = "CC: " + cedulaCli;
    document.getElementById("direccionCliente").innerHTML = direccionCli;
    document.getElementById("direccionCliente").style.fontWeight = "bold";
    document.getElementById("ciudadCliente").innerHTML = ciudadCli;

    // AGREGAR PRODUCTOS A LA LISTA DE PRODUCTOS A PAGAR
    let nombresProd = ["Consulta general", "Esterilización perros raza grande", "Esterilización perros raza pequeña", "Esterilización gatos", "Hemograma"];
    let valorProd = [15000, 300000, 320000, 320000, 20000];
    var optProd = document.getElementById("selPro");
    for(let i=0; i<nombresProd.length; i++){
      let option = document.createElement("option");
      option.text = nombresProd[i] + " | $" + valorProd[i].toString();
      optProd.add(option);
    }

    // SUMAR LOS VALORES DE TODOS LOS PRODUCTOS EN LA FACTURA
    var valorTotalFac = 0;
    document.getElementById("valTot").innerHTML = "$0,00";
    function suma(filas){
      let impTotal = "";
      let precio = table.rows[filas].cells[3].innerHTML;
      let valor = limpiarPrecio(precio);
      valorTotalFac += valor;
      
      impTotal = formato(valorTotalFac);

      document.getElementById("valTot").innerHTML = "$" + impTotal + ",00";
      document.getElementById("valTot").style.fontWeight = "bold";
      document.getElementById("valTot").classList.add("text-left");
    }

    // FUNCIÓN PARA AGREGAR ELEMENTOS A LA TABLA DE LA FACTURA
    var tbodyRef = table.getElementsByTagName('tbody')[0];
    function agregarProducto(){
      let tbodyRowCount = table.tBodies[0].rows.length;
      let cant = document.getElementById("cantidadProducto").value; // Cantidad del producto
      let row = tbodyRef.insertRow();
      let cell1 = row.insertCell(0);
      let cell2 = row.insertCell(1);
      let cell3 = row.insertCell(2);
      let cell4 = row.insertCell(3);
      let x = document.getElementById("selPro").selectedIndex;
      let y = document.getElementById("selPro").options;
      indice = y[x].index - 1;
      cell1.innerHTML = nombresProd[indice];
      cell2.innerHTML = "$" + formato(valorProd[indice]);
      cell3.innerHTML = cant;
      cell4.innerHTML = "$" + formato(valorProd[indice] * cant);
      document.getElementById("cantidadProducto").value = "";
      suma(tbodyRowCount+1)
    }

    // DAR FORMATO A NUMEROS
    function formato(numero){
      if(numero < 1000){
        return String(numero);
      }
      else if(numero < 1000000){
        return formatoMil(numero);
      }else if(numero >= 1000000){
        return formatoMillon(numero);
      }
    }

    // DAR FORMATO DE MIL
    function formatoMil(numero){
      string = numero.toString();
      let posPunto = string.length % 3;
      if(posPunto == 0){
        string = string.substring(0, posPunto+3) + "." + string.substring(posPunto+3, string.length);
      }else{
        string = string.substring(0, posPunto) + "." + string.substring(posPunto, string.length);
      }
      return string;
    }

    // MUESTRA EL VALOR TOTAL DE LA FACTURA EN EL MODAL
    function mostrarValorFacturaModal(){
      let confFact = "El total de la factura es de " + document.getElementById("valTot").innerHTML;
      document.getElementById("divConfFact").innerHTML = confFact;
    }

    function limpiarTabla(){
      document.getElementById("bodyFact").innerHTML = "";
      document.getElementById("valTot").innerHTML = "$0,00";
      valorTotalFac = 0;
    }

    // CONVIERTE EL STRING DE UN PRECIO A UN NUMERO ENTERO
    function limpiarPrecio(string){
      let valor = string;
      valor = valor.slice(1);
      valor = valor.replace(",", "");
      valor = valor.replace(".", "");
      valor = parseInt(valor);
      return valor
    }

  </script>

  </body>
</html>

</body>
</html>